<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Household Meal Planner</title>
    <link rel="icon" type="image/png" href="favicon.png">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="style.css">
    <script src="https://js.stripe.com/v3/"></script>
</head>
<body>

    <div id="app-container">
        <!-- Sidebar Navigation -->
        <nav class="sidebar">
            <div class="sidebar-header">
                <img src="header.png" alt="Logo" class="sidebar-logo">
            </div>
            <ul class="sidebar-nav">
                <li><a href="#" class="nav-link active" data-target="meal-plan-section"><i class="fas fa-calendar-alt fa-fw"></i> <span>Meal Planner</span></a></li>
                <li><a href="#" class="nav-link" data-target="recipe-section"><i class="fas fa-book-open fa-fw"></i> <span>Recipes</span></a></li>
                <li><a href="#" class="nav-link" data-target="pantry-section"><i class="fas fa-box fa-fw"></i> <span>Pantry</span></a></li>
                <li><a href="#" class="nav-link" data-target="grocery-list-section"><i class="fas fa-shopping-cart fa-fw"></i> <span>Grocery List</span></a></li>
            </ul>
            <div class="sidebar-footer">
                 <a href="#" id="feedback-btn-sidebar" title="Send Feedback"><i class="fas fa-comment-dots fa-fw"></i> <span>Send Feedback</span></a>
                 <a href="/terms.html" target="_blank"><i class="fas fa-file-contract fa-fw"></i> <span>Terms</span></a>
                 <a href="/privacy.html" target="_blank"><i class="fas fa-user-secret fa-fw"></i> <span>Privacy</span></a>
            </div>
        </nav>

        <!-- Main Content -->
        <div class="main-content">
            <header class="top-bar">
                 <div id="auth-container">
                    <!-- Auth UI will be dynamically populated by script.js -->
                 </div>
            </header>

            <main class="content-wrapper">
                <!-- Login/Household Management View -->
                <div id="initial-view">
                    <section id="login-section" class="content-section active">
                        <!-- Login form will be injected here by script.js -->
                    </section>
                    <section id="household-manager" class="content-section">
                        <h2>Welcome! Join or Create a Household</h2>
                        <p>To share a pantry, create a new household or join one using an invite code.</p>
                        <div class="household-action"><h3>Create a New Household</h3><button id="create-household-btn">Create</button></div>
                        <hr>
                        <div class="household-action"><h3>Join an Existing Household</h3><input type="text" id="household-code-input" placeholder="Enter Invite Code"><button id="join-household-btn">Join</button></div>
                    </section>
                </div>

                <!-- Main App Content (Initially Hidden) -->
                <div id="app-content" style="display: none;">
                    <section id="meal-plan-section" class="content-section active">
                        <h2>Weekly Meal Planner</h2>
                        <div class="week-navigation">
                            <button id="prev-week-btn" class="secondary">&lt; Prev</button>
                            <h3 id="week-range-display"></h3>
                            <button id="next-week-btn" class="secondary">Next &gt;</button>
                        </div>
                        
                        <div id="planner-criteria" class="recipe-criteria">
                            <h3 class="collapsible-header">Planning Preferences</h3>
                            <div class="collapsible-content">
                                <div class="criteria-controls">
                                    <div class="criteria-group">
                                         <div class="sub-criteria-group">
                                            <h4>Main Preference</h4>
                                            <div class="checkbox-group">
                                                <label><input type="checkbox" id="use-pantry-items-checkbox"><span>Use Pantry Items</span></label>
                                            </div>
                                        </div>
                                        <div class="sub-criteria-group">
                                            <h4>Allergies & Restrictions</h4>
                                            <div class="checkbox-group">
                                                <label><input type="checkbox" name="plannerCriteria" value="Gluten-Free"><span>Gluten-Free</span></label>
                                                <label><input type="checkbox" name="plannerCriteria" value="Dairy-Free"><span>Dairy-Free</span></label>
                                                <label><input type="checkbox" name="plannerCriteria" value="Lactose-Intolerance"><span>Lactose-Intolerance</span></label>
                                                <label><input type="checkbox" name="plannerCriteria" value="Kosher"><span>Kosher</span></label>
                                                <label><input type="checkbox" name="plannerCriteria" value="Halal"><span>Halal</span></label>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="criteria-group">
                                         <div class="sub-criteria-group premium-feature">
                                            <h4>Common Diets <span class="premium-tag">Premium</span></h4>
                                            <div class="checkbox-group">
                                                <label><input type="checkbox" name="plannerCriteria" value="Vegetarian"><span>Vegetarian</span></label>
                                                <label><input type="checkbox" name="plannerCriteria" value="Vegan"><span>Vegan</span></label>
                                                <label><input type="checkbox" name="plannerCriteria" value="Pescetarian"><span>Pescetarian</span></label>
                                                <label><input type="checkbox" name="plannerCriteria" value="Keto"><span>Keto</span></label>
                                                <label><input type="checkbox" name="plannerCriteria" value="Paleo"><span>Paleo</span></label>
                                                <label><input type="checkbox" name="plannerCriteria" value="Low Carb"><span>Low Carb</span></label>
                                                <label><input type="checkbox" name="plannerCriteria" value="Low Fat"><span>Low Fat</span></label>
                                                <label><input type="checkbox" name="plannerCriteria" value="High Protein"><span>High Protein</span></label>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="criteria-group">
                                        <div class="sub-criteria-group premium-feature">
                                            <h4>Other <span class="premium-tag">Premium</span></h4>
                                             <div class="checkbox-group">
                                                <label><input type="checkbox" name="plannerCriteria" value="Budget-Friendly"><span>Budget-Friendly</span></label>
                                                <label><input type="checkbox" name="plannerCriteria" value="Spicy"><span>Spicy</span></label>
                                                <label><input type="checkbox" name="plannerCriteria" value="Quick Meal (<30 minutes)"><span>&lt; 30 min</span></label>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="button-group" style="margin-top: 1rem;">
                            <button id="plan-my-week-btn" class="premium-feature">âœ¨ Complete My Week</button>
                        </div>
                        <div class="meal-plan-container">
                            <div id="meal-planner-grid"></div>
                        </div>
                        <div class="button-group" style="margin-top: 1rem;">
                            <button id="generate-grocery-list-btn">Generate Grocery List</button>
                            <button id="sync-calendar-btn" class="secondary premium-feature"><i class="far fa-calendar-alt"></i> Sync Calendar</button>
                        </div>
                    </section>

                    <section id="recipe-section" class="content-section">
                        <h2>Meal Sources</h2>
                        <div class="source-tabs">
                            <button id="show-ideas-tab" class="active">Meal Ideas</button>
                            <button id="show-favorites-tab">Favorites</button>
                        </div>
                        <div id="ideas-content">
                            <div class="meal-type-selector" id="meal-type-selector">
                                <label><input type="radio" name="mealType" value="breakfast"><span>Breakfast</span></label>
                                <label><input type="radio" name="mealType" value="lunch"><span>Lunch</span></label>
                                <label><input type="radio" name="mealType" value="dinner" checked><span>Dinner</span></label>
                                <label><input type="radio" name="mealType" value="snack"><span>Snack</span></label>
                            </div>
                            <div class="recipe-criteria">
                                <h3 class="collapsible-header">Refine Your Search</h3>
                                <div class="collapsible-content">
                                    <div class="criteria-controls">
                                        <div class="criteria-group">
                                            <label for="cuisine-select">Cuisine</label>
                                            <select id="cuisine-select"><option value="">Any</option></select>
                                            <button id="update-cuisine-btn" style="display:none;">Update Cuisine</button>
                                        </div>
                                        <div class="criteria-group">
                                            <label>Unit System</label>
                                            <div class="toggle-switch">
                                                <input type="radio" id="imperial-units" name="unitSystem" value="imperial" checked>
                                                <label for="imperial-units">Imperial</label>
                                                <input type="radio" id="metric-units" name="unitSystem" value="metric">
                                                <label for="metric-units">Metric</label>
                                            </div>
                                        </div>
                                        <div class="criteria-group">
                                            <div class="sub-criteria-group">
                                                <h4>Allergies & Restrictions</h4>
                                                <div class="checkbox-group">
                                                    <label><input type="checkbox" name="recipeCriteria" value="Gluten-Free"><span>Gluten-Free</span></label>
                                                    <label><input type="checkbox" name="recipeCriteria" value="Dairy-Free"><span>Dairy-Free</span></label>
                                                    <label><input type="checkbox" name="recipeCriteria" value="Lactose-Intolerance"><span>Lactose-Intolerance</span></label>
                                                    <label><input type="checkbox" name="recipeCriteria" value="Kosher"><span>Kosher</span></label>
                                                    <label><input type="checkbox" name="recipeCriteria" value="Halal"><span>Halal</span></label>
                                                </div>
                                            </div>
                                            <div class="sub-criteria-group premium-feature">
                                                <h4>Common Diets <span class="premium-tag">Premium</span></h4>
                                                <div class="checkbox-group">
                                                    <label><input type="checkbox" name="recipeCriteria" value="Vegetarian"><span>Vegetarian</span></label>
                                                    <label><input type="checkbox" name="recipeCriteria" value="Vegan"><span>Vegan</span></label>
                                                    <label><input type="checkbox" name="recipeCriteria" value="Pescetarian"><span>Pescetarian</span></label>
                                                    <label><input type="checkbox" name="recipeCriteria" value="Keto"><span>Keto</span></label>
                                                    <label><input type="checkbox" name="recipeCriteria" value="Paleo"><span>Paleo</span></label>
                                                    <label><input type="checkbox" name="recipeCriteria" value="Low Carb"><span>Low Carb</span></label>
                                                    <label><input type="checkbox" name="recipeCriteria" value="Low Fat"><span>Low Fat</span></label>
                                                    <label><input type="checkbox" name="recipeCriteria" value="High Protein"><span>High Protein</span></label>
                                                </div>
                                            </div>
                                            <div class="sub-criteria-group premium-feature">
                                                <h4>Other <span class="premium-tag">Premium</span></h4>
                                                 <div class="checkbox-group">
                                                    <label><input type="checkbox" name="recipeCriteria" value="Budget-Friendly"><span>Budget-Friendly</span></label>
                                                    <label><input type="checkbox" name="recipeCriteria" value="Spicy"><span>Spicy</span></label>
                                                    <label><input type="checkbox" name="recipeCriteria" value="Quick Meal (<30 minutes)"><span>&lt; 30 min</span></label>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div id="ask-the-chef-section" class="recipe-criteria premium-feature">
                                <h3>Ask the Chef <span class="premium-tag">Premium</span></h3>
                                <form id="ask-the-chef-form" class="inline-form">
                                    <input type="text" id="chef-query-input" placeholder="e.g., 'Classic Cheeseburger'">
                                    <button type="submit">Get Recipe</button>
                                </form>
                            </div>
                            <div id="recipe-scan-ui-placeholder"></div>
                            <div class="button-group">
                                <button id="suggest-recipe-btn">Suggest from Pantry</button>
                                <button id="quick-meal-btn">Quick Meal from Photo</button>
                                <button id="discover-recipes-btn" class="btn-accent">Discover New Recipes</button>
                            </div>
                        </div>
                        <div id="recipe-results"></div>
                        <div id="favorite-recipes-container" style="display: none;"></div>
                    </section>

                    <section id="pantry-section" class="content-section">
                        <div class="pantry-header">
                            <h2>My Pantry</h2>
                            <div class="pantry-controls">
                                <button id="show-manual-add-btn" class="secondary">Add Manually</button>
                                <button id="show-scan-item-btn" class="secondary">Scan Item</button>
                                <button id="show-scan-receipt-btn" class="secondary premium-feature">Scan Receipt</button>
                            </div>
                        </div>
                        <div id="add-item-container" class="add-item-container" style="display: none;">
                             <div id="manual-add-container" style="display: none;">
                                <h3>Add Item Manually</h3>
                                <form id="manual-add-form" class="form-grid">
                                    <input type="text" id="manual-name" placeholder="Item Name" required>
                                    <input type="number" id="manual-quantity" placeholder="Quantity" value="1" required>
                                    <input type="text" id="manual-unit" placeholder="Unit (e.g., lbs)" value="units" required>
                                    <select id="manual-category"></select>
                                    <button type="submit">Add</button>
                                </form>
                            </div>
                            <div id="confirmation-section" style="display: none;">
                                <h3>Confirm Scanned Items</h3>
                                <div id="item-confirmation-list"></div>
                                <button id="add-to-pantry-btn">Add Items to Pantry</button>
                            </div>
                        </div>
                        <div class="pantry-header" style="margin-top: 24px;">
                            <h3>Pantry Items</h3>
                            <div class="pantry-controls">
                                <button id="toggle-all-pantry-btn" class="secondary">Expand All</button>
                            </div>
                        </div>
                        <div id="pantry-bulk-controls" class="bulk-controls" style="display: none;">
                            <label><input type="checkbox" id="select-all-pantry-checkbox"> Select All</label>
                            <button id="delete-selected-pantry-btn" class="danger">Delete Selected</button>
                        </div>
                        <div id="pantry-list"></div>
                    </section>

                    <section id="grocery-list-section" class="content-section">
                        <h2>Grocery List</h2>
                        <div class="button-group">
                            <button id="show-add-grocery-form-btn" class="secondary">Add Manually</button>
                            <button id="show-scan-grocery-btn" class="secondary">Scan Item(s)</button>
                            <button id="show-scan-receipt-grocery-btn" class="secondary premium-feature">Scan Receipt</button>
                        </div>
                        <form id="add-grocery-item-form" class="inline-form" style="display: none;">
                            <input type="text" id="grocery-item-name" placeholder="e.g., Milk" required>
                            <select id="grocery-item-category"></select>
                            <button type="submit">Add</button>
                        </form>
                        <div id="grocery-scan-ui-placeholder"></div>
                        <div class="pantry-header" style="margin-top: 24px;">
                            <h3>Your Items</h3>
                            <div class="pantry-controls">
                                <button id="toggle-all-grocery-btn" class="secondary">Expand All</button>
                            </div>
                        </div>
                        <div id="grocery-bulk-controls" class="bulk-controls" style="display: none;">
                             <label><input type="checkbox" id="select-all-grocery-checkbox"> Select All</label>
                            <button id="delete-selected-grocery-btn" class="danger">Delete Selected</button>
                            <button id="move-to-pantry-btn" class="secondary">Move to Pantry</button>
                        </div>
                        <div id="grocery-list"></div>
                        <div id="move-to-pantry-form-container" style="display: none; margin-top: 20px;">
                            <h3>Confirm Items to Add to Pantry</h3>
                            <form id="move-to-pantry-form"></form>
                            <button id="confirm-move-btn" style="margin-top: 10px;">Confirm and Move</button>
                        </div>
                    </section>
                </div>
            </main>
        </div>
    </div>

    <!-- Modals and other floating elements -->
    <div id="scan-item-container">
        <h3>Scan New Items</h3>
        <div id="scan-quota-display" style="display: none; text-align: center; margin-bottom: 1rem; font-weight: 500;"></div>
        <div id="camera-container" style="display: none;"><video id="camera-stream" autoplay playsinline></video><canvas id="capture-canvas" style="display:none;"></canvas></div>
        <img id="captured-image" alt="Captured from pantry" style="display: none;">
        <div id="camera-controls">
            <button id="start-camera-btn">Start Camera</button>
            <button id="capture-btn" style="display: none;">Capture & Scan</button>
            <button id="close-scan-btn" class="danger">Close</button>
        </div>
    </div>

    <div id="meal-plan-modal" class="modal"><div class="modal-content"><span class="close-btn" id="modal-close-btn">&times;</span><h3 id="modal-slot-title"></h3><div id="modal-recipe-list"></div></div></div>
    <div id="add-to-plan-modal" class="modal"><div class="modal-content"><span class="close-btn" id="add-to-plan-modal-close-btn">&times;</span><h3>Add Recipe to Meal Plan</h3><p>Select dates and mealtime for: <strong id="add-to-plan-recipe-title"></strong></p><form id="add-to-plan-form"><div id="calendar-container"><div id="calendar-header"><button type="button" id="calendar-prev-month" class="secondary">&lt;</button><h4 id="calendar-month-year"></h4><button type="button" id="calendar-next-month" class="secondary">&gt;</button></div><div id="calendar-grid"></div></div><label for="meal-select">Mealtime:</label><select id="meal-select" required><option value="breakfast">Breakfast</option><option value="lunch">Lunch</option><option value="dinner">Dinner</option></select><button type="submit">Add to Plan</button></form></div></div>
    <div id="create-household-modal" class="modal"><div class="modal-content"><span class="close-btn" id="create-household-modal-close-btn">&times;</span><h3>Create Your Household</h3><p>Select your household's primary cuisine preference.</p><form id="create-household-form"><label for="household-cuisine-select">Cuisine Preference</label><select id="household-cuisine-select" required><option value="">Any</option></select><button type="submit">Create Household</button></form></div></div>
    <div id="how-to-modal" class="modal"><div class="modal-content"><div class="how-to-slider"><div class="how-to-slide active"><h3>Welcome!</h3><p>Let's quickly walk through the main features.</p></div><div class="how-to-slide"><h3>1. Your Pantry</h3><p>Use the 'Pantry' tab to add ingredients you have at home.</p></div><div class="how-to-slide"><h3>2. Get Recipes</h3><p>In the 'Recipes' tab, get meal ideas based on what's in your pantry.</p></div><div class="how-to-slide"><h3>3. Plan Your Week</h3><p>Assign recipes from the 'Recipes' tab onto your 'Meal Planner'.</p></div><div class="how-to-slide"><h3>4. Create a Grocery List</h3><p>Click 'Generate Grocery List' to see what you need to buy.</p></div></div><div class="how-to-navigation"><button id="how-to-prev-btn" class="secondary" style="display: none;">Previous</button><div class="how-to-dots"></div><button id="how-to-next-btn">Next</button><button id="how-to-close-btn" style="display: none;">Got it!</button></div></div></div>
    <div id="sync-calendar-modal" class="modal"><div class="modal-content"><span class="close-btn" id="sync-calendar-modal-close-btn">&times;</span><h3>Sync Your Meal Plan</h3><p>Subscribe to this calendar URL in your favorite calendar app.</p><div class="calendar-url-container"><input type="text" id="calendar-url-input" readonly><button id="copy-calendar-url-btn" title="Copy URL"><i class="far fa-copy"></i></button></div><hr><h4>How to add:</h4><ul class="instructions-list-modal"><li><strong>Google Calendar:</strong> Other calendars &rarr; "+" &rarr; From URL.</li><li><strong>Apple Calendar:</strong> File &rarr; New Calendar Subscription.</li></ul></div></div>
    <div id="feedback-modal" class="modal"><div class="modal-content"><span class="close-btn" id="feedback-modal-close-btn">&times;</span><h3>Share Your Feedback</h3><p>Have a suggestion or found a bug? Let us know!</p><form id="feedback-form"><textarea id="feedback-textarea" placeholder="Your feedback..." required></textarea><button type="submit">Submit Feedback</button></form></div></div>

    <div id="toast-notification"></div>

    <script type="module" src="script.js"></script>
</body>
</html>
